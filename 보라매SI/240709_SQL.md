



# SQL
## 테이블 명 참고

- CCCCCLTC
- CCCCCSTE
- PCTPCPAM : 환자정보
- ACPETHCD : 하이패스카드등록정보

## 테이블 정보 조회
DH에서 검색하면 안에 새부 정보까지 알 수 있음

```sql
/*이재강 책임님*/
EXEC :COMN_GRP_CD_NM := '진료기록';

SELECT B.COMN_GRP_CD_NM, A.*
  FROM CCCCCSTE A
     , (SELECT COMN_GRP_CD, COMN_GRP_CD_NM
          FROM CCCCCLTC
         WHERE COMN_GRP_CD_NM LIKE '%'||:COMN_GRP_CD_NM||'%') B
 WHERE A.COMN_GRP_CD IN B.COMN_GRP_CD
 ORDER BY A.COMN_GRP_CD, A.SCRN_MRK_SEQ;
```
### 테이블 정보 조회하는 법(ORACLE)
- 01 OBJECT 조회
    ```sql
    SELECT *
    FROM ALL_OBJECTS
    WHERE OBJECT_NAME LIKE 'OBJECT명'
    ```
- 02 TABLE 조회
    ```sql
    SELECT *
    FROM ALL_TABLES
    WHERE TABLE_NAME LIKE 'TABLE명'
    ```
- 03 SYNONYM 조회
    ```sql
    SELECT *
    FROM ALL_SYNONYMS
    WHERE SYNONYM_NAME = 'SYNONYM명'
    ```
- 04 TABLE의 INDEX 정보
    ```sql
    SELECT * 
    FROM ALL_IND_COLUMNS
    WHERE TABLE_NAME = 'TABLE명'
    ```
- 05 TABLE의 COLUMN 정보
    ```sql
    SELECT * 
    FROM ALL_TAB_COLUMNS
    WHERE TABLE_NAME = 'TABLE명'
    ```
- 06 TABLE COMMENT 정보
    ```sql
    SELECT * 
    FROM ALL_TAB_COMMENTS
    WHERE TABLE_NAME = '명'
    ```
- 07 COLUMN COMMENT 정보
    ```sql
    SELECT *
    FROM ALL_COL_COMMENTS
    WHERE TABLE_NAME = 'TABLE명'
    ```





## 모바일하이패스 화면 승인 조회 쿼리
### asis 접속방법(엣지의 익스플로어 모드)
- [url](http://dev10.brmh.org/EMR/CCO/CCOMAN/login.aspx)

    ![asis](/img/모바일하이패스asis.png)

쿼리 작성 페이지로 이동 : [240710.sql](/SQL/240710.sql)
### 쿼리 필요 colunms 구상
- 신청일자
- 환자번호

- 환자명
- 주민번호

- 승인여부
- 환자급종

- 시작일자(첫 진료)
- 종료일자(마지막 진료)

- 카드회사
- 카드 명의자
- 카드번호

#### 필요 테이블
- pctpcpam : 환자정보
- ACPETHCD : 하이패스카드등록정보

### 암복화
페트라? 사용

- 카드 번호 : 100
- 주민번호 : 800

#### 암호화
```
pls_encrypt_b64_id(pt_no, 100)
```

#### 복호화
```
pls_decrypt_b64_id(card_no, 100)
```



## ASIS 쿼리 조회 방법
### 방법 1 PLEdit32 이용(추천)
- 인증번호 : EZCARETECHKOREA22982

예를 들어, '모바일하이패스' 캡쳐를 보면, 페이지.url이 있는데, ASIS를 설치하고, 그 부분을 참고해서, 경로를 Drill Down으로 찾아가면 된다.

-> 'CreateHipssMobileAprv.aspx' 라는 파일을 찾을 수 있다.
    ![asis하이패스](/img/asis모바일하이패슴aspx.png)


-> 화면에 있는 'pkg_bil_ocals.pc_ap_HipssMobileAprvList' 복사

-> (인증이 되어있는)'PLEdit32' 이라는 프로그램에서 Ctrl + D 를 한 후에 

![asis하이패스](/img/pledit32모바일.png)


-> 양 사이드에 SQL처럼 %를 붙여서 패키지명 'pkg_bil_ocals' 조회

-> 패키지 안에서 'pc_ap_HipssMobileAprvList' 조회

#### 주의
![주의](/img/edit.png)
- ID : xbil
- PASS : x1234

입력 후, 단 시간 기다려야 붙을 수 있음. 곧 바로 조회되지 않았음.




### 방법 2 DH에서 EQS.DB2  이용
이 방법으로 조회는 가능하나, 복사가 안되며, Ctrl + F 안 먹어서 노가다로 찾아야 한다.

대신 Ctrl + A로 전체 복사 후, 텍스트에서 찾는 방법도 있다. -> Crtl + C 복사가 안된다.