

- 진료과별 환자종류별 진료실적
- 진료과별 환자종류별 입원/외래환자수
- 진료과별 지역별 의사별/실외래환자수 
- 진료과별 지역별 의사별/2010,11년 수납기준환자수
- 진료과별 일자별 외래/입원 환자현황
- 의사별 환자종류별 입원/퇴원 환자수
- 병동별 환자종류별 입원/퇴원 환자수





```sql
/***********************************************************************************
    *    서비스이름      : pc_sel_pts02_income916
    *    최초 작성일     : 2010-03-05
    *    최초 작성자     :
    *    Description     : 진료과별 일자별 외래/입원 환자현황
    *    Input Parameter :
    *    페이지ID        : /MIS/PTS/PTS/PTS/READCLCDAYOIPTRPT.ASPX
    ***********************************************************************************/
    procedure pc_sel_pts02_income916 (
            in_fromyymm      in   varchar2
        ,   in_io_gubun      in   varchar2      --      '1' 입원 ,'2' 외래   ,'3' 전체
        ,   out_cursor1      out  returncursor
        ,   out_cursor2      out  returncursor
        )
        is
        wk_cursor1 returncursor;
        wk_cursor2 returncursor;
    begin
        /*
            --M20210312 sjkang, 조회로직 수정
            전체 진료과가 출력 안되는 문제가 있어 기획과(이송미) 요청으로 수정한다.
            
            1) 현재는 진료과 추가의 경우 화면수정이 필요하기 때문에
               가로열과 세로열 헤더 출력을 바꿈
               가로 : 날짜(최대 31일), 세로 : 진료과명
            2) 기존 진료과 코드가 아닌 명칭으로 변경
               진료과 gropy by 조건은 진료과별 환자종류별 입원/외래환자수 와 동일하게 맞춤
               pkg_mis_pts_pts_pts02.pc_sel_pts02_income009
            
            exec    xgpts.pkg_mis_pts_pts_pts02.pc_sel_pts02_income916('201902', '1', :var_out1, :var_out2);
        */
        --  data
        open wk_cursor1 for
        select  (
                    select  x.dept_nm
                      from  ccdepart    x
                     where  x.dept_cd   =   a.med_dept
                )                   as  "진료과명"
             ,  sum(
                nvl(a.d01, 0) + nvl(a.d02, 0) + nvl(a.d03, 0) + nvl(a.d04, 0) + nvl(a.d05, 0)
             +  nvl(a.d06, 0) + nvl(a.d07, 0) + nvl(a.d08, 0) + nvl(a.d09, 0) + nvl(a.d10, 0)
             +  nvl(a.d11, 0) + nvl(a.d12, 0) + nvl(a.d13, 0) + nvl(a.d14, 0) + nvl(a.d15, 0)
             +  nvl(a.d16, 0) + nvl(a.d17, 0) + nvl(a.d18, 0) + nvl(a.d19, 0) + nvl(a.d20, 0)
             +  nvl(a.d21, 0) + nvl(a.d22, 0) + nvl(a.d23, 0) + nvl(a.d24, 0) + nvl(a.d25, 0)
             +  nvl(a.d26, 0) + nvl(a.d27, 0) + nvl(a.d28, 0) + nvl(a.d29, 0) + nvl(a.d30, 0)
             +  nvl(a.d31, 0))      as  "진료과계"
             
             ,  sum(nvl(a.d01, 0))  as  "01 일"
             ,  sum(nvl(a.d02, 0))  as  "02 일"
             ,  sum(nvl(a.d03, 0))  as  "03 일"
             ,  sum(nvl(a.d04, 0))  as  "04 일"
             ,  sum(nvl(a.d05, 0))  as  "05 일"
             ,  sum(nvl(a.d06, 0))  as  "06 일"
             ,  sum(nvl(a.d07, 0))  as  "07 일"
             ,  sum(nvl(a.d08, 0))  as  "08 일"
             ,  sum(nvl(a.d09, 0))  as  "09 일"
             ,  sum(nvl(a.d10, 0))  as  "10 일"
             ,  sum(nvl(a.d11, 0))  as  "11 일"
             ,  sum(nvl(a.d12, 0))  as  "12 일"
             ,  sum(nvl(a.d13, 0))  as  "13 일"
             ,  sum(nvl(a.d14, 0))  as  "14 일"
             ,  sum(nvl(a.d15, 0))  as  "15 일"
             ,  sum(nvl(a.d16, 0))  as  "16 일"
             ,  sum(nvl(a.d17, 0))  as  "17 일"
             ,  sum(nvl(a.d18, 0))  as  "18 일"
             ,  sum(nvl(a.d19, 0))  as  "19 일"
             ,  sum(nvl(a.d20, 0))  as  "20 일"
             ,  sum(nvl(a.d21, 0))  as  "21 일"
             ,  sum(nvl(a.d22, 0))  as  "22 일"
             ,  sum(nvl(a.d23, 0))  as  "23 일"
             ,  sum(nvl(a.d24, 0))  as  "24 일"
             ,  sum(nvl(a.d25, 0))  as  "25 일"
             ,  sum(nvl(a.d26, 0))  as  "26 일"
             ,  sum(nvl(a.d27, 0))  as  "27 일"
             ,  sum(nvl(a.d28, 0))  as  "28 일"
             ,  sum(nvl(a.d29, 0))  as  "29 일"
             ,  sum(nvl(a.d30, 0))  as  "30 일"
             ,  sum(nvl(a.d31, 0))  as  "31 일"
          from  (
                    select  a.med_dept
                         ,  nvl(a.d01, 0) + nvl(a.d02, 0) + nvl(a.d03, 0) + nvl(a.d04, 0) + nvl(a.d05, 0)
                         +  nvl(a.d06, 0) + nvl(a.d07, 0) + nvl(a.d08, 0) + nvl(a.d09, 0) + nvl(a.d10, 0)
                         +  nvl(a.d11, 0) + nvl(a.d12, 0) + nvl(a.d13, 0) + nvl(a.d14, 0) + nvl(a.d15, 0)
                         +  nvl(a.d16, 0) + nvl(a.d17, 0) + nvl(a.d18, 0) + nvl(a.d19, 0) + nvl(a.d20, 0)
                         +  nvl(a.d21, 0) + nvl(a.d22, 0) + nvl(a.d23, 0) + nvl(a.d24, 0) + nvl(a.d25, 0)
                         +  nvl(a.d26, 0) + nvl(a.d27, 0) + nvl(a.d28, 0) + nvl(a.d29, 0) + nvl(a.d30, 0)
                         +  nvl(a.d31, 0)   dept_sum
                         ,  nvl(a.d01, 0)   d01
                         ,  nvl(a.d02, 0)   d02
                         ,  nvl(a.d03, 0)   d03
                         ,  nvl(a.d04, 0)   d04
                         ,  nvl(a.d05, 0)   d05
                         ,  nvl(a.d06, 0)   d06
                         ,  nvl(a.d07, 0)   d07
                         ,  nvl(a.d08, 0)   d08
                         ,  nvl(a.d09, 0)   d09
                         ,  nvl(a.d10, 0)   d10
                         ,  nvl(a.d11, 0)   d11
                         ,  nvl(a.d12, 0)   d12
                         ,  nvl(a.d13, 0)   d13
                         ,  nvl(a.d14, 0)   d14
                         ,  nvl(a.d15, 0)   d15
                         ,  nvl(a.d16, 0)   d16
                         ,  nvl(a.d17, 0)   d17
                         ,  nvl(a.d18, 0)   d18
                         ,  nvl(a.d19, 0)   d19
                         ,  nvl(a.d20, 0)   d20
                         ,  nvl(a.d21, 0)   d21
                         ,  nvl(a.d22, 0)   d22
                         ,  nvl(a.d23, 0)   d23
                         ,  nvl(a.d24, 0)   d24
                         ,  nvl(a.d25, 0)   d25
                         ,  nvl(a.d26, 0)   d26
                         ,  nvl(a.d27, 0)   d27
                         ,  nvl(a.d28, 0)   d28
                         ,  nvl(a.d29, 0)   d29
                         ,  nvl(a.d30, 0)   d30
                         ,  nvl(a.d31, 0)   d31
                      from  (
                                select  *
                                  from  (
                                            --01. 외래
                                            select  to_char(y.med_dte, 'dd')        day_cls
                                                 ,  case
                                                        when y.med_dept in ('HPC1','HPC11') then 'HPC'
                                                        when y.med_dept = 'BCGS'            then 'GS'
                                                        when y.med_dept = 'BCOL'            then 'OL'
                                                        when y.med_dept = 'BCPS'            then 'PS'
                                                        when y.med_dept = 'BCDR'            then 'DR'
                                                        when y.med_dept = 'CVGS'            then 'GS'
                                                        when y.med_dept = 'CVIMC'           then 'IMC'
                                                        when y.med_dept = 'CVTS'            then 'TS'
                                                        when y.med_dept = 'DEIME'           then 'IME'
                                                        when y.med_dept = 'OGO2'            then 'OG'
                                                        when y.med_dept = 'RCIMR'           then 'IMR'
                                                        when y.med_dept = 'RCNP'            then 'NP'
                                                        when y.med_dept = 'RCTS'            then 'TS'
                                                        when y.med_dept = 'THDR'            then 'DR'
                                                        when y.med_dept = 'THGS'            then 'GS'
                                                        when y.med_dept = 'THIME'           then 'IME'
                                                        when y.med_dept = 'THNM'            then 'NM'
                                                        when y.med_dept = 'THOL'            then 'OL'
                                                        when y.med_dept = 'ONP'             then 'NP'
                                                        else y.med_dept
                                                    end                             med_dept
                                                 ,  sum(y.rsv_cnt + y.today_cnt)    tcnt
                                              from  apstatmt2   y
                                             where  y.med_dte   between to_date(in_fromyymm||'01','yyyymmdd')
                                                                    and case
                                                                            when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) - 1
                                                                            then last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                                                            else trunc(sysdate) - 1
                                                                        end
                                               and  y.dtl_typ   =   '06'
                                               and  y.patsite   in  ('O', 'E')
                                               and  case
                                                        when in_io_gubun = '1' then '1'
                                                        when in_io_gubun = '2' then '2'
                                                        else '3'
                                                    end         =   case
                                                                        when in_io_gubun = '1' then 'X'
                                                                        when in_io_gubun = '2' then '2'
                                                                        else '3'
                                                                    end
                                             group  by
                                                    to_char(y.med_dte, 'dd')
                                                 ,  case
                                                        when y.med_dept in ('HPC1','HPC11') then 'HPC'
                                                        when y.med_dept = 'BCGS'            then 'GS'
                                                        when y.med_dept = 'BCOL'            then 'OL'
                                                        when y.med_dept = 'BCPS'            then 'PS'
                                                        when y.med_dept = 'BCDR'            then 'DR'
                                                        when y.med_dept = 'CVGS'            then 'GS'
                                                        when y.med_dept = 'CVIMC'           then 'IMC'
                                                        when y.med_dept = 'CVTS'            then 'TS'
                                                        when y.med_dept = 'DEIME'           then 'IME'
                                                        when y.med_dept = 'OGO2'            then 'OG'
                                                        when y.med_dept = 'RCIMR'           then 'IMR'
                                                        when y.med_dept = 'RCNP'            then 'NP'
                                                        when y.med_dept = 'RCTS'            then 'TS'
                                                        when y.med_dept = 'THDR'            then 'DR'
                                                        when y.med_dept = 'THGS'            then 'GS'
                                                        when y.med_dept = 'THIME'           then 'IME'
                                                        when y.med_dept = 'THNM'            then 'NM'
                                                        when y.med_dept = 'THOL'            then 'OL'
                                                        when y.med_dept = 'ONP'             then 'NP'
                                                        else y.med_dept
                                                    end
                                            --02. 입원
                                             union  all
                                            select  to_char(y.med_dte, 'dd')        day_cls
                                                 ,  y.med_dept
                                                 ,  sum(y.tcnt)                     tcnt
                                              from  (
                                                        select  y.med_dte
                                                             ,  case
                                                                    when y.med_dept in ('HPC1','HPC11') then 'HPC'
                                                                    when y.med_dept = 'BCGS'            then 'GS'
                                                                    when y.med_dept = 'BCOL'            then 'OL'
                                                                    when y.med_dept = 'BCPS'            then 'PS'
                                                                    when y.med_dept = 'BCDR'            then 'DR'
                                                                    when y.med_dept = 'CVGS'            then 'GS'
                                                                    when y.med_dept = 'CVIMC'           then 'IMC'
                                                                    when y.med_dept = 'CVTS'            then 'TS'
                                                                    when y.med_dept = 'DEIME'           then 'IME'
                                                                    when y.med_dept = 'OGO2'            then 'OG'
                                                                    when y.med_dept = 'RCIMR'           then 'IMR'
                                                                    when y.med_dept = 'RCNP'            then 'NP'
                                                                    when y.med_dept = 'RCTS'            then 'TS'
                                                                    when y.med_dept = 'THDR'            then 'DR'
                                                                    when y.med_dept = 'THGS'            then 'GS'
                                                                    when y.med_dept = 'THIME'           then 'IME'
                                                                    when y.med_dept = 'THNM'            then 'NM'
                                                                    when y.med_dept = 'THOL'            then 'OL'
                                                                    when y.med_dept = 'ONP'             then 'NP'
                                                                    else y.med_dept
                                                                end                             med_dept
                                                             ,  y.jespcrsv_cnt                  tcnt
                                                          from  apstatmt2   y
                                                         where  y.med_dte   between to_date(in_fromyymm||'01','yyyymmdd')
                                                                                and case
                                                                                        when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) - 1
                                                                                        then last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                                                                        else trunc(sysdate) - 1
                                                                                    end
                                                           and  y.dtl_typ   =   'M01'
                                                           and  y.patsite   =   'I'
                                                           and  y.wk_key    =   '1'
                                                         union  all
                                                        select  y.med_dte + 1                   med_dte
                                                             ,  case
                                                                    when y.med_dept in ('HPC1','HPC11') then 'HPC'
                                                                    when y.med_dept = 'BCGS'            then 'GS'
                                                                    when y.med_dept = 'BCOL'            then 'OL'
                                                                    when y.med_dept = 'BCPS'            then 'PS'
                                                                    when y.med_dept = 'BCDR'            then 'DR'
                                                                    when y.med_dept = 'CVGS'            then 'GS'
                                                                    when y.med_dept = 'CVIMC'           then 'IMC'
                                                                    when y.med_dept = 'CVTS'            then 'TS'
                                                                    when y.med_dept = 'DEIME'           then 'IME'
                                                                    when y.med_dept = 'OGO2'            then 'OG'
                                                                    when y.med_dept = 'RCIMR'           then 'IMR'
                                                                    when y.med_dept = 'RCNP'            then 'NP'
                                                                    when y.med_dept = 'RCTS'            then 'TS'
                                                                    when y.med_dept = 'THDR'            then 'DR'
                                                                    when y.med_dept = 'THGS'            then 'GS'
                                                                    when y.med_dept = 'THIME'           then 'IME'
                                                                    when y.med_dept = 'THNM'            then 'NM'
                                                                    when y.med_dept = 'THOL'            then 'OL'
                                                                    when y.med_dept = 'ONP'             then 'NP'
                                                                    else y.med_dept
                                                                end                             med_dept
                                                             ,  y.jespcrsv_cnt * -1             tcnt
                                                          from  apstatmt2   y
                                                         where  y.med_dte   between to_date(in_fromyymm||'01','yyyymmdd')
                                                                                and case
                                                                                        when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) - 1
                                                                                        then last_day(to_date(in_fromyymm||'01','yyyymmdd')) - 1
                                                                                        else trunc(sysdate) - 2
                                                                                    end
                                                           and  y.dtl_typ   =   'M01'
                                                           and  y.patsite   =   'I'
                                                           and  y.wk_key    =   '1'
                                                    )   y
                                             where  case
                                                        when in_io_gubun = '1' then '1'
                                                        when in_io_gubun = '2' then '2'
                                                        else '3'
                                                    end         =   case
                                                                        when in_io_gubun = '1' then '1'
                                                                        when in_io_gubun = '2' then 'X'
                                                                        else '3'
                                                                    end

                                             group  by
                                                    to_char(y.med_dte, 'dd')
                                                 ,  y.med_dept

                                        )
                                 pivot  (
                                            sum(tcnt) for day_cls
                                                   in  ( '01' as "D01",'02' as "D02",'03' as "D03",'04' as "D04",'05' as "D05"
                                                        ,'06' as "D06",'07' as "D07",'08' as "D08",'09' as "D09",'10' as "D10"
                                                        ,'11' as "D11",'12' as "D12",'13' as "D13",'14' as "D14",'15' as "D15"
                                                        ,'16' as "D16",'17' as "D17",'18' as "D18",'19' as "D19",'20' as "D20"
                                                        ,'21' as "D21",'22' as "D22",'23' as "D23",'24' as "D24",'25' as "D25"
                                                        ,'26' as "D26",'27' as "D27",'28' as "D28",'29' as "D29",'30' as "D30"
                                                        ,'31' as "D31",'32' as "P01"
                                                       )
                                        )
                            )   a
                )   a
         group  by
                rollup((a.med_dept))
         order  by
                a.med_dept
        ;        
/*
         select
                case when to_char(b.med_dte,'yyyy-mm-dd') is NULL then '합계'
                     else to_char(b.med_dte,'yyyy-mm-dd')
                end                                                                                                   med_dte
               ,sum(case when y.med_dte = b.med_dte then y.tcnt else 0 end)                                           med0
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 1  and y.med_dte = b.med_dte then y.tcnt else 0 end) med1
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 2  and y.med_dte = b.med_dte then y.tcnt else 0 end) med2
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 3  and y.med_dte = b.med_dte then y.tcnt else 0 end) med3
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 4  and y.med_dte = b.med_dte then y.tcnt else 0 end) med4
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 5  and y.med_dte = b.med_dte then y.tcnt else 0 end) med5
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 6  and y.med_dte = b.med_dte then y.tcnt else 0 end) med6
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 7  and y.med_dte = b.med_dte then y.tcnt else 0 end) med7
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 8  and y.med_dte = b.med_dte then y.tcnt else 0 end) med8
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 9  and y.med_dte = b.med_dte then y.tcnt else 0 end) med9
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 10 and y.med_dte = b.med_dte then y.tcnt else 0 end) med10
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 11 and y.med_dte = b.med_dte then y.tcnt else 0 end) med11
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 12 and y.med_dte = b.med_dte then y.tcnt else 0 end) med12
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 13 and y.med_dte = b.med_dte then y.tcnt else 0 end) med13
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 14 and y.med_dte = b.med_dte then y.tcnt else 0 end) med14
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 15 and y.med_dte = b.med_dte then y.tcnt else 0 end) med15
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 16 and y.med_dte = b.med_dte then y.tcnt else 0 end) med16
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 17 and y.med_dte = b.med_dte then y.tcnt else 0 end) med17
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 18 and y.med_dte = b.med_dte then y.tcnt else 0 end) med18
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 19 and y.med_dte = b.med_dte then y.tcnt else 0 end) med19
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 20 and y.med_dte = b.med_dte then y.tcnt else 0 end) med20
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 21 and y.med_dte = b.med_dte then y.tcnt else 0 end) med21
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 22 and y.med_dte = b.med_dte then y.tcnt else 0 end) med22
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 23 and y.med_dte = b.med_dte then y.tcnt else 0 end) med23
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 24 and y.med_dte = b.med_dte then y.tcnt else 0 end) med24
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 25 and y.med_dte = b.med_dte then y.tcnt else 0 end) med25
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 26 and y.med_dte = b.med_dte then y.tcnt else 0 end) med26
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 27 and y.med_dte = b.med_dte then y.tcnt else 0 end) med27
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 28 and y.med_dte = b.med_dte then y.tcnt else 0 end) med28
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 29 and y.med_dte = b.med_dte then y.tcnt else 0 end) med29
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 30 and y.med_dte = b.med_dte then y.tcnt else 0 end) med30
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 31 and y.med_dte = b.med_dte then y.tcnt else 0 end) med31
               ,sum(case when x.rank = y.dp_rank and y.dp_rank = 32 and y.med_dte = b.med_dte then y.tcnt else 0 end) med32
           from
               (
                select dept_cd         med_dept
                      ,rownum rank
                  from
                      (
                       select case when dept_cd = 'BCGS' then
                                        'GS'
                                   when dept_cd in ('HPC1','HPC11') then
                                        'HPC'
                                   else
                                        dept_cd
                              end dept_cd
                         from ccdepart
                        where meddept_typ = 'A'
                          and dept_lvl in ('3','4')
                          and updept_cd in ('ME','IM','BRC','EMC')
                          and dept_cd not  in ('HMC','PA')
                          and disuse_dte is NULL
                        group by
                                case when dept_cd = 'BCGS' then
                                          'GS'
                                     when dept_cd in ('HPC1','HPC11') then
                                          'HPC'
                                     else
                                          dept_cd
                                end
                                ,serial_seq
                        order by serial_seq
                      )
               ) x
               ,
               (
                select
                       y.med_dte
                      ,case when y.med_dept = 'BCGS' then
                                 'GS'
                            when y.med_dept in ('HPC1','HPC11') then
                                 'HPC'
                            else
                                 y.med_dept
                       end                        med_dept
                      ,sum(y.rsv_cnt+y.today_cnt) tcnt
                      ,max(x.rank)                dp_rank
                  from apstatmt2 y
                      ,
                      (
                       select
                              to_date(in_fromyymm||'01','yyyymmdd') star_dte
                             ,case when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) -1 then
                                        last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                   else
                                        trunc(sysdate) -1
                              end     end_dte
                         from dual
                      )
                     ,
                     (
                      select dept_cd         med_dept
                            ,rownum rank
                        from
                            (
                             select case when dept_cd = 'BCGS' then
                                              'GS'
                                         when dept_cd in ('HPC1','HPC11') then
                                              'HPC'
                                         else
                                              dept_cd
                                    end dept_cd
                               from ccdepart
                              where meddept_typ = 'A'
                                and dept_lvl in ('3','4')
                                and updept_cd in ('ME','IM','BRC','EMC')
                                and dept_cd not  in ('HMC','PA')
                                and disuse_dte is NULL
                              group by
                                      case when dept_cd = 'BCGS' then
                                                'GS'
                                           when dept_cd in ('HPC1','HPC11') then
                                                'HPC'
                                           else
                                                dept_cd
                                      end
                                      ,serial_seq
                              order by serial_seq
                            )
                     ) x
                 where y.med_dte between star_dte and end_dte
                   and y.dtl_typ = '06'
                   and y.patsite in ('O','E')
                   and x.med_dept = case when y.med_dept = 'BCGS' then
                                              'GS'
                                         when y.med_dept in ('HPC1','HPC11') then
                                              'HPC'
                                         else
                                              y.med_dept
                                    end
                   and case when in_io_gubun = '1' then '1'
                            when in_io_gubun = '2' then '2'
                            else '3'
                       end
                           =
                             case when in_io_gubun = '1' then 'X'
                                  when in_io_gubun = '2' then '2'
                                  else '3'
                             end
                 group by
                          case when y.med_dept = 'BCGS' then
                                    'GS'
                               when y.med_dept in ('HPC1','HPC11') then
                                    'HPC'
                               else
                                    y.med_dept
                          end
                         ,y.med_dte
                union all
                select
                       y.med_dte
                      ,case when y.med_dept = 'BCGS' then
                                 'GS'
                            when y.med_dept in ('HPC1','HPC11') then
                                 'HPC'
                            else
                                 y.med_dept
                       end                        med_dept
                      ,sum(y.jespcrsv_cnt)        t_cnt --shspcmed_cnt
                      ,max(x.rank)                dp_rank
                  from
                      (
                       select
                              med_dte
                             ,med_dept
                             ,wd_no
                             ,jespcrsv_cnt
                         from apstatmt2
                             ,
                             (
                              select
                                     to_date(in_fromyymm||'01','yyyymmdd') star_dte
                                    ,case when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) -1 then
                                               last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                          else
                                               trunc(sysdate) -1
                                     end     end_dte
                                from dual
                             )
                        where med_dte between star_dte and end_dte
                          and dtl_typ = 'M01'
                          and patsite = 'I'
                          and wk_key  = '1'
--                          and wd_no not in ('ER99') --'OR99','OGOB',
                       union all
                       select
                              med_dte+1           med_dte
                             ,med_dept            med_dept
                             ,wd_no
                             ,jespcrsv_cnt*(-1)   jespcrsv_cnt
                         from apstatmt2
                             ,
                             (
                              select
                                     to_date(in_fromyymm||'01','yyyymmdd') star_dte
                                    ,case when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) -1 then
                                               last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                          else
                                               trunc(sysdate) -1
                                     end     end_dte
                                from dual
                             )
                        where med_dte between star_dte and end_dte-1
                          and dtl_typ = 'M01'
                          and patsite = 'I'
                          and wk_key  = '1'
--                          and wd_no not in ('ER99') --'OR99','OGOB',
                      ) y
                      ,
                      (
                       select
                              to_date(in_fromyymm||'01','yyyymmdd') star_dte
                             ,case when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) -1 then
                                        last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                   else
                                        trunc(sysdate) -1
                              end     end_dte
                         from dual
                      )
                     ,
                     (
                      select dept_cd         med_dept
                            ,rownum rank
                        from
                            (
                             select case when dept_cd = 'BCGS' then
                                              'GS'
                                         when dept_cd in ('HPC1','HPC11') then
                                              'HPC'
                                         else
                                              dept_cd
                                    end dept_cd
                               from ccdepart
                              where meddept_typ = 'A'
                                and dept_lvl in ('3','4')
                                and updept_cd in ('ME','IM','BRC','EMC')
                                and dept_cd not  in ('HMC','PA')
                                and disuse_dte is NULL
                              group by
                                      case when dept_cd = 'BCGS' then
                                                'GS'
                                           when dept_cd in ('HPC1','HPC11') then
                                                'HPC'
                                           else
                                                dept_cd
                                      end
                                      ,serial_seq
                              order by serial_seq
                            )
                     ) x
                 where x.med_dept = case when y.med_dept = 'BCGS' then
                                              'GS'
                                         when y.med_dept in ('HPC1','HPC11') then
                                              'HPC'
                                         else
                                              y.med_dept
                                    end
                   and case when in_io_gubun = '1' then '1'
                            when in_io_gubun = '2' then '2'
                            else '3'
                       end
                           =
                             case when in_io_gubun = '1' then '1'
                                  when in_io_gubun = '2' then 'X'
                                  else '3'
                             end
                 group by
                          case when y.med_dept = 'BCGS' then
                                    'GS'
                               when y.med_dept in ('HPC1','HPC11') then
                                    'HPC'
                               else
                                    y.med_dept
                          end
                         ,y.med_dte
               ) y
               ,
               (select in_fromyymm  mm
                      ,lpad(rownum,2,'0')            dd
                      ,to_date(in_fromyymm||lpad(rownum,2,'0'),'yyyymmdd') med_dte
                  from dict
                 where rownum <= to_number(to_char(last_day(to_date(in_fromyymm||'01','yyyymmdd')),'dd'))
               ) b
          where to_char(last_day(to_date(b.mm||'01','yyyymmdd')),'dd') >= b.dd
            and x.med_dept = y.med_dept
          group by
                   rollup(to_char(b.med_dte,'yyyy-mm-dd'))
          order by
                   to_char(b.med_dte,'yyyy-mm-dd')
                ;
*/
                --      title
        open wk_cursor2 for
        select  '진료과'    dept_hd
             ,  '계'        dept_sum
             ,  a.*
          from  (
                    select  *
                      from  (
                                select  to_char(x.dte, 'dd')    day_cls
                                     ,  to_char(x.dte, 'dd') || ' 일'   col_hd
                                  from  ccdatemt    x
                                 where  x.dte       between to_date(in_fromyymm||'01','yyyymmdd')
                                                        and case
                                                                when last_day(to_date(in_fromyymm||'01','yyyymmdd')) < trunc(sysdate) - 1
                                                                then last_day(to_date(in_fromyymm||'01','yyyymmdd'))
                                                                else trunc(sysdate) - 1
                                                            end
                            )
                     pivot  (
                                max(col_hd) as col_hd
                                            for day_cls
                                            in  ('01' as "D01",'02' as "D02",'03' as "D03",'04' as "D04",'05' as "D05"
                                                ,'06' as "D06",'07' as "D07",'08' as "D08",'09' as "D09",'10' as "D10"
                                                ,'11' as "D11",'12' as "D12",'13' as "D13",'14' as "D14",'15' as "D15"
                                                ,'16' as "D16",'17' as "D17",'18' as "D18",'19' as "D19",'20' as "D20"
                                                ,'21' as "D21",'22' as "D22",'23' as "D23",'24' as "D24",'25' as "D25"
                                                ,'26' as "D26",'27' as "D27",'28' as "D28",'29' as "D29",'30' as "D30"
                                                ,'31' as "D31",'32' as "P01"
                                               )
                            )
                )   a
        ;        
/*
      select
             '일자'                                                   med_dept
            ,'계'                                                     med0
            ,med1                                                     med1
            ,med2                                                     med2
            ,med3                                                     med3
            ,med4                                                     med4
            ,med5                                                     med5
            ,med6                                                     med6
            ,med7                                                     med7
            ,med8                                                     med8
            ,med9                                                     med9
            ,med10                                                    med10
            ,med11                                                    med11
            ,med12                                                    med12
            ,med13                                                    med13
            ,med14                                                    med14
            ,med15                                                    med15
            ,med16                                                    med16
            ,med17                                                    med17
            ,med18                                                    med18
            ,med19                                                    med19
            ,med20                                                    med20
            ,med21                                                    med21
            ,med22                                                    med22
            ,med23                                                    med23
            ,med24                                                    med24
            ,med25                                                    med25
            ,med26                                                    med26
            ,med27                                                    med27
            ,med28                                                    med28
            ,med29                                                    med29
            ,med30                                                    med30
            ,med31                                                    med31
            ,med32                                                    med32
        from
            (
             select lv
                   ,min(decode(x.rank,1 ,decode(lv,1,x.med_dept))) med1
                   ,min(decode(x.rank,2 ,decode(lv,1,x.med_dept))) med2
                   ,min(decode(x.rank,3 ,decode(lv,1,x.med_dept))) med3
                   ,min(decode(x.rank,4 ,decode(lv,1,x.med_dept))) med4
                   ,min(decode(x.rank,5 ,decode(lv,1,x.med_dept))) med5
                   ,min(decode(x.rank,6 ,decode(lv,1,x.med_dept))) med6
                   ,min(decode(x.rank,7 ,decode(lv,1,x.med_dept))) med7
                   ,min(decode(x.rank,8 ,decode(lv,1,x.med_dept))) med8
                   ,min(decode(x.rank,9 ,decode(lv,1,x.med_dept))) med9
                   ,min(decode(x.rank,10,decode(lv,1,x.med_dept))) med10
                   ,min(decode(x.rank,11,decode(lv,1,x.med_dept))) med11
                   ,min(decode(x.rank,12,decode(lv,1,x.med_dept))) med12
                   ,min(decode(x.rank,13,decode(lv,1,x.med_dept))) med13
                   ,min(decode(x.rank,14,decode(lv,1,x.med_dept))) med14
                   ,min(decode(x.rank,15,decode(lv,1,x.med_dept))) med15
                   ,min(decode(x.rank,16,decode(lv,1,x.med_dept))) med16
                   ,min(decode(x.rank,17,decode(lv,1,x.med_dept))) med17
                   ,min(decode(x.rank,18,decode(lv,1,x.med_dept))) med18
                   ,min(decode(x.rank,19,decode(lv,1,x.med_dept))) med19
                   ,min(decode(x.rank,20,decode(lv,1,x.med_dept))) med20
                   ,min(decode(x.rank,21,decode(lv,1,x.med_dept))) med21
                   ,min(decode(x.rank,22,decode(lv,1,x.med_dept))) med22
                   ,min(decode(x.rank,23,decode(lv,1,x.med_dept))) med23
                   ,min(decode(x.rank,24,decode(lv,1,x.med_dept))) med24
                   ,min(decode(x.rank,25,decode(lv,1,x.med_dept))) med25
                   ,min(decode(x.rank,26,decode(lv,1,x.med_dept))) med26
                   ,min(decode(x.rank,27,decode(lv,1,x.med_dept))) med27
                   ,min(decode(x.rank,28,decode(lv,1,x.med_dept))) med28
                   ,min(decode(x.rank,29,decode(lv,1,x.med_dept))) med29
                   ,min(decode(x.rank,30,decode(lv,1,x.med_dept))) med30
                   ,min(decode(x.rank,31,decode(lv,1,x.med_dept))) med31
                   ,min(decode(x.rank,32,decode(lv,1,x.med_dept))) med32
               from
                   (
                    select dept_cd         med_dept
                          ,rownum rank
                      from
                          (
                           select case when dept_cd = 'BCGS' then
                                            'GS'
                                       when dept_cd in ('HPC1','HPC11') then
                                            'HPC'
                                       else
                                            dept_cd
                                  end dept_cd
                             from ccdepart
                            where meddept_typ = 'A'
                              and dept_lvl in ('3','4')
                              and updept_cd in ('ME','IM','BRC','EMC')
                              and dept_cd not  in ('HMC','PA')
                              and disuse_dte is NULL
                            group by
                                    case when dept_cd = 'BCGS' then
                                              'GS'
                                         when dept_cd in ('HPC1','HPC11') then
                                              'HPC'
                                         else
                                              dept_cd
                                    end
                                    ,serial_seq
                            order by serial_seq
                          )
                   ) x
                   ,
                   (
                    select level lv
                      from dual
                    connect by level <=1
                   ) c
              group by lv
            )
                ;
*/

                out_cursor1 := wk_cursor1;
                out_cursor2 := wk_cursor2;

                exception
                        when others then
                                raise_application_error(-20500,'pc_sel_pts02_income916 오류!' || chr(13) || 'err_cd = '|| sqlcode || chr(13) || ' ' || sqlerrm);
        end pc_sel_pts02_income916;

```